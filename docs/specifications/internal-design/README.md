# Works Logue - 内部設計書

**バージョン**: 1.0  
**最終更新**: 2026年1月24日  
**ステータス**: 実装済み

## ドキュメント構成

この内部設計書は、Works Logueプロジェクトの内部実装設計をまとめたものです。以下のセクションに分かれています：

### 📖 設計書一覧

| ドキュメント | ファイル | 説明 | ステータス |
|-------------|---------|------|----------|
| **システムアーキテクチャ** | [architecture.md](architecture.md) | 全体構成、FSD設計、Next.js統合 | ✅ 完了 |
| **データベース設計** | [database.md](database.md) | ER図、テーブル設計、インデックス戦略 | ✅ 完了 |
| **コンポーネント設計** | [component-design.md](component-design.md) | React/Next.jsコンポーネント設計 | ✅ 完了 |
| **パフォーマンス設計** | [performance.md](performance.md) | 最適化戦略、監視、計測 | ✅ 完了 |

### 🗂️ クイックナビゲーション

#### システムアーキテクチャ関連
- [全体アーキテクチャ](architecture.md#1-全体アーキテクチャ) - システム全体の構成図とレイヤー設計
- [FSD アーキテクチャ](architecture.md#2-feature-sliced-design-fsd-アーキテクチャ) - レイヤー構成と公開API設計
- [Next.js App Router統合](architecture.md#3-nextjs-app-router-統合パターン) - ファイルベースルーティングとFSDの統合
- [データフロー設計](architecture.md#4-データフロー設計) - Server Actions + Server Components

#### データベース設計関連
- [ER図・テーブル構成](database.md#2-er図・テーブル構成) - 全体的なデータベース構造
- [主要テーブル詳細](database.md#22-主要テーブル詳細設計) - User、Article、Comment等の詳細設計
- [インデックス戦略](database.md#23-インデックス戦略) - パフォーマンス最適化のための索引設計
- [Prismaスキーマ設計](database.md#3-prismaスキーマ設計) - ORM設定と型定義

#### コンポーネント設計関連
- [FSDレイヤー別構成](component-design.md#11-fsdレイヤー別コンポーネント構成) - 各レイヤーのコンポーネント分類
- [shadcn/ui統一戦略](component-design.md#12-shadcnui-統一コンポーネント戦略) - デザインシステムの統一方針
- [Server/Client分離](component-design.md#22-serverclient-component-分離戦略) - React 19のコンポーネント戦略
- [主要コンポーネント例](component-design.md#3-主要コンポーネント実装例) - 実装済みコンポーネントの設計

#### パフォーマンス設計関連
- [Web Vitals目標](performance.md#11-web-vitals-目標値) - パフォーマンス指標と目標値
- [データベース最適化](performance.md#2-データベースパフォーマンス最適化) - クエリ最適化とキャッシュ戦略
- [Next.js最適化](performance.md#3-nextjs-パフォーマンス最適化) - 静的生成・キャッシュ・Bundle Size
- [画像・メディア最適化](performance.md#5-画像・メディア最適化) - Image最適化とCloudinary統合

## 設計原則

### 📐 内部設計の基本方針

1. **Feature-Sliced Design**: 体系的なコード構造と保守性重視
2. **型安全性**: TypeScriptによる厳密な型定義
3. **パフォーマンス**: データベース・フロントエンド双方の最適化
4. **可読性・保守性**: 明確な責務分離とドキュメント化
5. **拡張性**: 将来の機能追加に対応できる柔軟な設計

### 🎯 技術的制約・考慮事項

#### アーキテクチャ制約
- **Next.js App Router**: ファイルベースルーティングの制約
- **FSD準拠**: レイヤー間の依存関係制御
- **React Server Components**: サーバー・クライアント境界の適切な設計
- **TypeScript**: 型安全性の維持

#### データベース制約
- **PostgreSQL**: 関係データベースの正規化制約
- **Prisma ORM**: スキーマ駆動開発の制約
- **パフォーマンス**: 大量データに対するクエリ最適化
- **整合性**: 外部キー制約による参照整合性

#### パフォーマンス制約
- **Web Vitals**: Google Core Web Vitals基準の遵守
- **SEO**: 検索エンジン最適化要件
- **モバイル**: モバイルファーストの性能要件
- **スケーラビリティ**: 将来的なトラフィック増加への対応

## アーキテクチャ決定記録 (ADR)

### 🤔 主要な技術選定理由

#### 1. Feature-Sliced Design (FSD) 採用
**決定**: プロジェクト全体でFSDアーキテクチャを採用  
**理由**:
- 大規模プロジェクトでの保守性向上
- チーム開発での一貫したコード構造
- ビジネスロジックの適切な分離

#### 2. Next.js App Router + React Server Components
**決定**: Next.js 15 App Routerを中心としたアーキテクチャ  
**理由**:
- SSR/SSG/ISRの柔軟な選択
- React 19の新機能活用
- SEO・パフォーマンスの両立

#### 3. Prisma ORM採用
**決定**: データベースアクセスはPrisma ORMで統一  
**理由**:
- 型安全なデータベースアクセス
- マイグレーション管理の簡素化
- TypeScriptとの高い親和性

#### 4. shadcn/ui統一戦略
**決定**: UIコンポーネントはshadcn/uiで統一  
**理由**:
- 一貫したデザインシステム
- カスタマイズ性とアクセシビリティの両立
- Tailwind CSS との高い親和性

## 実装ガイドライン

### 📋 開発時の注意事項

#### FSD実装時
- 公開API（index.ts）を必ず作成
- レイヤー間の不正なインポートを防止
- スライス内の責務を明確に分離

#### データベース実装時
- マイグレーションファイルの手動編集禁止
- N+1問題を常に意識したクエリ設計
- インデックス効果の定期的な検証

#### パフォーマンス実装時
- Core Web Vitalsの継続的な測定
- 重いコンポーネントの適切な分割
- 画像最適化の徹底

#### コンポーネント実装時
- Server/Client Componentの適切な選択
- shadcn/ui variantsAPIの積極活用
- 再利用性を考慮した設計

## 継続的改善

### 📊 監視・測定項目

#### パフォーマンス監視
- Web Vitals指標の定期測定
- データベースクエリパフォーマンス
- バンドルサイズの変化追跡
- API応答時間の監視

#### コード品質監視
- TypeScript型エラーの定期チェック
- ESLintルール違反の監視
- テストカバレッジの維持
- コンポーネント複雑度の測定

### 🔄 改善プロセス

#### 四半期レビュー
- アーキテクチャ設計の見直し
- パフォーマンス指標の評価
- 技術的負債の棚卸し
- 新技術導入の検討

#### 機能追加時
- FSD原則に沿った設計確認
- 既存アーキテクチャとの整合性
- パフォーマンスへの影響評価
- ドキュメント更新の実施

## 関連ドキュメント

### 📚 他の設計書との関係

- **[要件定義書](../requirements/)** ← 内部設計の基となる要件
- **[外部設計書](../external-design/)** ← 内部設計で実現する外部インターフェース
- **[デプロイメント仕様書](../deployment/)** → 内部設計を本番環境で動作させる手順

### 🔄 更新・メンテナンス

- **新機能実装時**: 該当するアーキテクチャ・設計の更新
- **パフォーマンス改善時**: performance.md の戦略・測定結果更新
- **データベース変更時**: database.md のスキーマ・インデックス更新
- **コンポーネント追加時**: component-design.md の実装例更新

---

## 変更履歴

| 日付 | バージョン | 変更者 | 変更内容 |
|------|------------|--------|----------|
| 2026-01-24 | 1.0 | システム | 内部設計書をサブディレクトリ構造に分割・再編成 |